<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KalamDB TypeScript SDK - Browser Example</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #1e1e1e;
      color: #d4d4d4;
      height: 100vh;
      overflow: hidden;
    }
    .header {
      background: #2d2d30;
      padding: 15px 20px;
      border-bottom: 1px solid #3e3e42;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header h1 {
      color: #4CAF50;
      font-size: 20px;
      font-weight: 600;
      margin: 0;
    }
    .status {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .status.connected { background: #4CAF50; color: white; }
    .status.disconnected { background: #f44336; color: white; }
    
    .container {
      display: grid;
      grid-template-columns: 400px 1fr;
      height: calc(100vh - 60px);
    }
    
    /* Left Panel - Controls */
    .left-panel {
      background: #252526;
      border-right: 1px solid #3e3e42;
      overflow-y: auto;
      padding: 20px;
    }
    
    .section {
      background: #2d2d30;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 6px;
      border: 1px solid #3e3e42;
    }
    
    .section h2 {
      color: #4CAF50;
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      cursor: pointer;
      user-select: none;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .section h2:hover {
      color: #66bb6a;
    }
    
    .section h2 .toggle-icon {
      font-size: 12px;
      transition: transform 0.2s;
    }
    
    .section h2 .toggle-icon.collapsed {
      transform: rotate(-90deg);
    }
    
    .section-content {
      max-height: 1000px;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }
    
    .section-content.collapsed {
      max-height: 0;
    }
    
    .config label {
      display: block;
      color: #cccccc;
      font-size: 12px;
      margin-bottom: 4px;
      font-weight: 500;
    }
    
    .config input {
      width: 100%;
      padding: 8px 10px;
      margin-bottom: 10px;
      background: #1e1e1e;
      border: 1px solid #3e3e42;
      border-radius: 4px;
      color: #d4d4d4;
      font-size: 13px;
      font-family: 'Consolas', 'Monaco', monospace;
    }
    
    .config input:focus {
      outline: none;
      border-color: #4CAF50;
    }
    
    button {
      background: #0e639c;
      color: white;
      padding: 8px 14px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: 500;
      width: 100%;
      margin-bottom: 6px;
      text-align: left;
      transition: background 0.2s;
    }
    
    button:hover {
      background: #1177bb;
    }
    
    button:disabled {
      background: #3e3e42;
      color: #808080;
      cursor: not-allowed;
    }
    
    button.danger {
      background: #f44336;
    }
    
    button.danger:hover {
      background: #d32f2f;
    }
    
    button.success {
      background: #4CAF50;
    }
    
    button.success:hover {
      background: #45a049;
    }
    
    /* Right Panel - Console */
    .right-panel {
      background: #1e1e1e;
      display: flex;
      flex-direction: column;
    }
    
    .console-header {
      background: #2d2d30;
      padding: 10px 15px;
      border-bottom: 1px solid #3e3e42;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .console-header h3 {
      color: #cccccc;
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .console-actions button {
      padding: 4px 10px;
      font-size: 11px;
      width: auto;
      margin: 0 0 0 8px;
    }
    
    .sql-query-area {
      background: #2d2d30;
      padding: 15px;
      border-bottom: 1px solid #3e3e42;
    }
    
    .sql-query-area h3 {
      color: #cccccc;
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 10px;
    }
    
    #sqlQuery {
      width: 100%;
      min-height: 80px;
      background: #1e1e1e;
      border: 1px solid #3e3e42;
      border-radius: 4px;
      color: #d4d4d4;
      padding: 10px;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      resize: vertical;
      line-height: 1.5;
    }
    
    #sqlQuery:focus {
      outline: none;
      border-color: #4CAF50;
    }
    
    .sql-actions {
      margin-top: 10px;
      display: flex;
      gap: 8px;
    }
    
    .sql-actions button {
      width: auto;
      padding: 6px 16px;
    }
    
    #output {
      flex: 1;
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      padding-bottom: 60px;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      overflow-y: scroll;
      white-space: pre-wrap;
      word-wrap: break-word;
      line-height: 1.6;
      max-height: calc(100vh - 290px);
    }
    
    /* Subscription Status Bar */
    .subscription-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: #2d2d30;
      border-top: 1px solid #4CAF50;
      padding: 8px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 12px;
      z-index: 1000;
    }
    
    .subscription-bar .count {
      color: #4CAF50;
      font-weight: 600;
    }
    
    .subscription-bar .count.zero {
      color: #808080;
    }
    
    .subscription-bar .subscriptions-list {
      flex: 1;
      margin-left: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      overflow: hidden;
    }
    
    .subscription-bar .sub-item {
      background: #3e3e42;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      color: #d4d4d4;
      max-width: 300px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      border: 1px solid #4CAF50;
    }
    
    .subscription-bar .sub-item .sub-id {
      color: #4CAF50;
      font-weight: 600;
    }
    
    .subscription-bar .ws-status {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .subscription-bar .ws-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #f44336;
    }
    
    .subscription-bar .ws-indicator.connected {
      background: #4CAF50;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .json-collapsible {
      cursor: pointer;
      user-select: none;
      display: inline-block;
      margin: 4px 0;
    }
    
    .json-collapsible:hover {
      opacity: 0.8;
    }
    
    .json-content {
      max-height: 150px;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
      display: inline-block;
      vertical-align: top;
    }
    
    .json-content.expanded {
      max-height: 10000px;
    }
    
    .json-toggle {
      color: #4CAF50;
      font-weight: bold;
      margin-left: 8px;
    }
    
    #subscriptionOutput {
      background: #2d2d30;
      padding: 12px;
      border-radius: 4px;
      border: 1px solid #3e3e42;
      min-height: 100px;
      max-height: 250px;
      overflow-y: auto;
      margin-top: 10px;
      font-size: 12px;
    }
    
    .log-info { color: #4FC3F7; }
    .log-error { color: #ef5350; }
    .log-success { color: #66bb6a; }
    .log-warning { color: #ffb74d; }
    
    /* Scrollbar styling */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }
    
    ::-webkit-scrollbar-track {
      background: #1e1e1e;
    }
    
    ::-webkit-scrollbar-thumb {
      background: #3e3e42;
      border-radius: 5px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
      background: #4e4e52;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>üöÄ KalamDB TypeScript SDK - Browser Test</h1>
    <span id="status" class="status disconnected">Server Offline</span>
  </div>

  <div class="container">
    <!-- Left Panel - Controls -->
    <div class="left-panel">
      <div class="section">
        <h2 onclick="toggleSection('config')">
          ‚öôÔ∏è Configuration
          <span class="toggle-icon">‚ñº</span>
        </h2>
        <div class="section-content" id="config-content">
          <div class="config">
            <label>
              Server URL:
              <input type="text" id="serverUrl" value="http://localhost:8080" />
            </label>
            <label>
              Username:
              <input type="text" id="username" value="root" />
            </label>
            <label>
              Password:
              <input type="password" id="password" value="" />
            </label>
          </div>
        </div>
      </div>

      <div class="section">
        <h2 onclick="toggleSection('basic')">
          üéÆ Basic Actions
          <span class="toggle-icon">‚ñº</span>
        </h2>
        <div class="section-content" id="basic-content">
          <button onclick="testInit()" class="success">Initialize WASM</button>
          <button onclick="testQuery()">Test Query (SELECT 1)</button>
          <button onclick="testCreateNamespace()">Create Namespace</button>
          <button onclick="testCreateTable()">Create Table</button>
          <button onclick="testInsert()">Insert Data</button>
          <button onclick="testSelect()">Query Data</button>
          <button onclick="runAll()" class="success">‚ñ∂Ô∏è Run All Tests</button>
        </div>
      </div>

      <div class="section">
        <h2 onclick="toggleSection('live')">
          üì° Live Subscriptions
          <span class="toggle-icon">‚ñº</span>
        </h2>
        <div class="section-content" id="live-content">
          <button onclick="testSubscribe()" id="subscribeBtn">üîî Subscribe to Todos</button>
          <button onclick="testUnsubscribe()" id="unsubscribeBtn" disabled>üîï Unsubscribe</button>
          <button onclick="testInsertLive()" id="insertLiveBtn" disabled>‚ûï Insert New Todo (Live)</button>
          <div id="subscriptionOutput">
            <div style="color: #808080; font-style: italic; font-size: 11px;">No active subscription</div>
          </div>
        </div>
      </div>

      <div class="section">
        <h2 onclick="toggleSection('stream')">
          üåä Stream Subscriptions
          <span class="toggle-icon">‚ñº</span>
        </h2>
        <div class="section-content" id="stream-content">
          <button onclick="testCreateAndSubscribeTodos()" id="createSubTodosBtn">üìã Create & Subscribe Todos</button>
          <button onclick="testCreateAndSubscribeEvents()" id="createSubEventsBtn">‚ö° Create & Subscribe Events (Stream)</button>
          <button onclick="testInsertEvent()" id="insertEventBtn" disabled>‚ûï Insert Event</button>
          <button onclick="testUnsubscribeAll()" id="unsubscribeAllBtn" disabled class="danger">üîï Unsubscribe All</button>
        </div>
      </div>
    </div>

    <!-- Right Panel - Console -->
    <div class="right-panel">
      <!-- SQL Query Area -->
      <div class="sql-query-area">
        <h3>üí¨ SQL Query</h3>
        <textarea id="sqlQuery" placeholder="Enter SQL query here... (e.g., SELECT * FROM my_namespace.todos)"></textarea>
        <div class="sql-actions">
          <button onclick="executeSqlQuery()" class="success">‚ñ∂Ô∏è Execute</button>
          <button onclick="clearSqlQuery()">Clear</button>
        </div>
      </div>
      
      <div class="console-header">
        <h3>üìã Console Output</h3>
        <div class="console-actions">
          <button onclick="clearOutput()" class="danger">Clear</button>
        </div>
      </div>
      <div id="output">Waiting for actions...</div>
    </div>
  </div>

  <!-- Subscription Status Bar -->
  <div class="subscription-bar">
    <div class="ws-status">
      <div id="wsIndicator" class="ws-indicator"></div>
      <span id="wsStatus">WebSocket: Disconnected</span>
    </div>
    <span id="subCount" class="count zero">0 Active Subscriptions</span>
    <div id="subList" class="subscriptions-list">
      <!-- Subscription items will be added here dynamically -->
    </div>
  </div>

  <script type="module" src="app.js"></script>
</body>
</html>
