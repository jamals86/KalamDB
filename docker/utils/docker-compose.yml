# docker-compose.yml
services:
  minio:
    image: minio/minio:latest
    entrypoint: >
      /bin/sh -c "
      minio server --address ':9000' --console-address ':9001' /data &
      sleep 5 &&
      /usr/bin/mc alias set minio http://127.0.0.1:9000 minioadmin minioadmin &&
      /usr/bin/mc mb minio/kalamdb-test 2>/dev/null || true &&
      /usr/bin/mc anonymous set public minio/kalamdb-test 2>/dev/null || true &&
      wait
      "
    ports:
      - "9120:9000"  # S3 API (external: localhost:9120)
      - "9121:9001"  # Web console
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
      # Allow unsigned requests (needed for local development)
      MINIO_CI: "on"
    volumes:
      - ./minio-data:/data

  jaeger:
    image: jaegertracing/all-in-one:1.35
    environment:
      - COLLECTOR_OTLP_ENABLED=true
    ports:
      - "16686:16686" # Jaeger UI
      - "4317:4317"   # OTLP gRPC (recommended)
      - "4318:4318"   # OTLP HTTP
      # optional legacy ports (keep commented unless you need them)
      # - "6831:6831/udp" # Jaeger compact thrift
      # - "14268:14268"   # Jaeger collector HTTP
      # - "14250:14250"   # Jaeger collector gRPC

  # webdav:
  #   image: bytemark/webdav:latest
  #   restart: unless-stopped
  #   ports:
  #     - "8077:80"
  #   environment:
  #     # For HTTP (no TLS), Digest auth avoids sending plaintext passwords
  #     AUTH_TYPE: Digest
  #     USERNAME: alice
  #     PASSWORD: secret1234

  #     # Optional: expose WebDAV under /webdav instead of /
  #     LOCATION: /webdav
  #   volumes:
  #     - ./dav-data:/var/lib/dav