openapi: 3.0.3
info:
  title: KalamDb API
  description: REST API for chat and AI message history storage with real-time streaming
  version: 1.0.0
  contact:
    name: KalamDb Team
servers:
  - url: http://localhost:8080
    description: Local development server
  - url: https://api.kalamdb.example.com
    description: Production server

security:
  - BearerAuth: []

paths:
  /api/v1/messages:
    post:
      summary: Submit a new message
      description: Store a message in the system. Returns immediately after writing to RocksDB.
      operationId: submitMessage
      tags:
        - Messages
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageRequest'
            examples:
              userMessage:
                summary: User message
                value:
                  conversationId: "conv_abc123"
                  from: "user_john"
                  timestamp: 1696800000000000
                  content: "Hello, how are you?"
                  metadata:
                    role: "user"
                    clientId: "web-app"
              aiResponse:
                summary: AI response
                value:
                  conversationId: "conv_abc123"
                  from: "ai_assistant"
                  timestamp: 1696800001500000
                  content: "I'm doing well, thank you!"
                  metadata:
                    role: "assistant"
                    model: "gpt-4"
                    tokens: 12
              mediaMessage:
                summary: Message with image attachment
                value:
                  conversationId: "conv_abc123"
                  from: "user_john"
                  timestamp: 1696800002000000
                  content: "Check out this vacation photo!"
                  contentRef: "s3://bucket/shared/conversations/conv_abc123/media-1234567890123456.jpg"
                  metadata:
                    role: "user"
                    contentType: "image/jpeg"
                    fileName: "vacation-photo.jpg"
                    fileSize: 2457600
                    width: 1920
                    height: 1080
                    thumbnail: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQ..."
      responses:
        '201':
          description: Message accepted and stored
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessageResponse'
        '400':
          description: Invalid request (missing required fields, content too large)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized (invalid or missing JWT token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '413':
          description: Message content exceeds size limit
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    get:
      summary: Query messages
      description: Retrieve messages with filtering and pagination. Queries both RocksDB (recent) and Parquet (historical).
      operationId: queryMessages
      tags:
        - Messages
      parameters:
        - name: userId
          in: query
          required: false
          description: Filter messages by user ID (defaults to authenticated user from JWT)
          schema:
            type: string
            example: "user_john"
        - name: conversationId
          in: query
          required: false
          description: Filter messages by conversation ID
          schema:
            type: string
            example: "conv_abc123"
        - name: sinceId
          in: query
          required: false
          description: Return messages with msgId > sinceId (for pagination or replay)
          schema:
            type: integer
            format: int64
            example: 1234567890123456
        - name: untilId
          in: query
          required: false
          description: Return messages with msgId < untilId
          schema:
            type: integer
            format: int64
            example: 1234567899999999
        - name: limit
          in: query
          required: false
          description: Maximum number of messages to return (default 50, max 1000)
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 50
            example: 50
        - name: order
          in: query
          required: false
          description: Sort order by msgId (default desc for latest first)
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: Messages retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MessagesResponse'
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/conversations:
    get:
      summary: List conversations
      description: Retrieve all conversations for a user with metadata (firstMsgId, lastMsgId, timestamps)
      operationId: listConversations
      tags:
        - Conversations
      parameters:
        - name: userId
          in: query
          required: false
          description: Filter conversations by user ID (defaults to authenticated user from JWT)
          schema:
            type: string
            example: "user_john"
      responses:
        '200':
          description: Conversations retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConversationsResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/conversations/{conversationId}:
    get:
      summary: Get conversation metadata
      description: Retrieve metadata for a specific conversation
      operationId: getConversation
      tags:
        - Conversations
      parameters:
        - name: conversationId
          in: path
          required: true
          description: Conversation identifier
          schema:
            type: string
            example: "conv_abc123"
      responses:
        '200':
          description: Conversation metadata retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Conversation'
        '404':
          description: Conversation not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/messages/upload:
    post:
      summary: Upload media file for message
      description: Upload a media file (image, document, audio, video) and receive a contentRef to use in message submission. Supports multipart/form-data upload.
      operationId: uploadMedia
      tags:
        - Messages
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - conversationId
                - file
              properties:
                conversationId:
                  type: string
                  description: Conversation ID where this media will be used
                  example: "conv_abc123"
                file:
                  type: string
                  format: binary
                  description: Media file to upload
                contentType:
                  type: string
                  description: MIME type of the file (auto-detected if not provided)
                  example: "image/jpeg"
                fileName:
                  type: string
                  description: Original file name
                  example: "vacation-photo.jpg"
      responses:
        '201':
          description: Media uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MediaUploadResponse'
        '400':
          description: Invalid request (missing file, unsupported content type)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '413':
          description: File too large (exceeds max_size_bytes config)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/messages/{msgId}/content:
    get:
      summary: Fetch full content for large message or media file
      description: Retrieve the complete content for a message stored in shared storage. Returns signed URL for media files or full text content.
      operationId: getMessageContent
      tags:
        - Messages
      parameters:
        - name: msgId
          in: path
          required: true
          description: Message ID
          schema:
            type: integer
            format: int64
            example: 1234567890123456
        - name: download
          in: query
          required: false
          description: If true, force download instead of inline display
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Full message content retrieved or signed URL returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ContentResponse'
            text/plain:
              schema:
                type: string
                example: "This is the full content of a large message..."
            image/*:
              schema:
                type: string
                format: binary
            audio/*:
              schema:
                type: string
                format: binary
            video/*:
              schema:
                type: string
                format: binary
            application/pdf:
              schema:
                type: string
                format: binary
            application/octet-stream:
              schema:
                type: string
                format: binary
        '404':
          description: Message not found or no large content available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (user does not have access to this message)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/conversations/{conversationId}/users:
    get:
      summary: List users in a conversation
      description: Retrieve all users who have access to this conversation
      operationId: listConversationUsers
      tags:
        - Conversations
      parameters:
        - name: conversationId
          in: path
          required: true
          description: Conversation identifier
          schema:
            type: string
            example: "conv_abc123"
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConversationUsersResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (user does not have access to this conversation)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Conversation not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    post:
      summary: Add a user to a conversation
      description: Grant a user access to this conversation. Requires admin or owner permissions.
      operationId: addConversationUser
      tags:
        - Conversations
      parameters:
        - name: conversationId
          in: path
          required: true
          description: Conversation identifier
          schema:
            type: string
            example: "conv_abc123"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConversationUserRequest'
      responses:
        '201':
          description: User added to conversation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConversationUser'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (insufficient permissions)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '409':
          description: User already in conversation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/conversations/{conversationId}/users/{userId}:
    get:
      summary: Get user's conversation membership details
      description: Retrieve details about a user's access to this conversation
      operationId: getConversationUser
      tags:
        - Conversations
      parameters:
        - name: conversationId
          in: path
          required: true
          description: Conversation identifier
          schema:
            type: string
            example: "conv_abc123"
        - name: userId
          in: path
          required: true
          description: User identifier
          schema:
            type: string
            example: "user_john"
      responses:
        '200':
          description: Conversation user details retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConversationUser'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found in conversation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      summary: Update user's conversation membership
      description: Update permissions or metadata for a user in this conversation
      operationId: updateConversationUser
      tags:
        - Conversations
      parameters:
        - name: conversationId
          in: path
          required: true
          description: Conversation identifier
          schema:
            type: string
            example: "conv_abc123"
        - name: userId
          in: path
          required: true
          description: User identifier
          schema:
            type: string
            example: "user_john"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConversationUserUpdate'
      responses:
        '200':
          description: User membership updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConversationUser'
        '400':
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (insufficient permissions)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found in conversation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      summary: Remove user from conversation
      description: Revoke a user's access to this conversation
      operationId: removeConversationUser
      tags:
        - Conversations
      parameters:
        - name: conversationId
          in: path
          required: true
          description: Conversation identifier
          schema:
            type: string
            example: "conv_abc123"
        - name: userId
          in: path
          required: true
          description: User identifier
          schema:
            type: string
            example: "user_john"
      responses:
        '204':
          description: User removed from conversation
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (insufficient permissions)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found in conversation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/query:
    post:
      summary: Execute SQL query
      description: Execute arbitrary SQL query against message data using DataFusion. Admin-only endpoint.
      operationId: executeSqlQuery
      tags:
        - Query
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - query
              properties:
                query:
                  type: string
                  description: SQL query string
                  example: "SELECT conversationId, COUNT(*) as msg_count FROM messages WHERE userId = 'user_john' GROUP BY conversationId"
                params:
                  type: object
                  description: Query parameters (for parameterized queries)
                  additionalProperties: true
                  example:
                    userId: "user_john"
      responses:
        '200':
          description: Query executed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/QueryResponse'
        '400':
          description: Invalid SQL query
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized (requires admin privileges)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/v1/health:
    get:
      summary: Health check
      description: Check if the server is running and healthy
      operationId: healthCheck
      tags:
        - System
      security: []
      responses:
        '200':
          description: Server is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  version:
                    type: string
                    example: "1.0.0"
                  uptime:
                    type: integer
                    description: Server uptime in seconds
                    example: 86400

  /api/admin/subscriptions:
    get:
      summary: List active subscriptions
      description: Retrieve all active WebSocket subscriptions. Admin-only.
      operationId: listSubscriptions
      tags:
        - Admin
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Active subscriptions retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SubscriptionsResponse'
        '401':
          description: Unauthorized (requires admin privileges)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/admin/config:
    get:
      summary: Get system configuration
      description: Retrieve current system configuration. Admin-only.
      operationId: getConfig
      tags:
        - Admin
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Configuration retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Config'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    put:
      summary: Update system configuration
      description: Update system configuration. Some changes require server restart. Admin-only.
      operationId: updateConfig
      tags:
        - Admin
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ConfigUpdate'
      responses:
        '200':
          description: Configuration updated (may require restart)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  requiresRestart:
                    type: boolean
                    description: True if server restart required for changes to take effect
                    example: true
        '400':
          description: Invalid configuration values
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/admin/metrics:
    get:
      summary: Get system metrics snapshot
      description: Retrieve current system metrics (storage, throughput, performance). Admin-only.
      operationId: getMetrics
      tags:
        - Admin
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Metrics retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Metrics'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token with userId in 'sub' claim

  schemas:
    MediaUploadResponse:
      type: object
      properties:
        contentRef:
          type: string
          description: Reference URI for the uploaded media file
          example: "s3://bucket/shared/conversations/conv_abc123/media-1234567890123456.jpg"
        contentType:
          type: string
          description: MIME type of the uploaded file
          example: "image/jpeg"
        fileSize:
          type: integer
          format: int64
          description: Size of the uploaded file in bytes
          example: 2457600
        thumbnail:
          type: string
          description: Base64-encoded thumbnail (for images/videos)
          nullable: true
          example: "data:image/jpeg;base64,/9j/4AAQ..."
        metadata:
          type: object
          description: Extracted metadata (dimensions, duration, etc.)
          additionalProperties: true
          example:
            width: 1920
            height: 1080

    ContentResponse:
      type: object
      properties:
        contentRef:
          type: string
          description: Reference URI for the content
          example: "s3://bucket/shared/conversations/conv_abc123/media-789.jpg"
        signedUrl:
          type: string
          description: Temporary signed URL for direct access (expires in 1 hour)
          example: "https://s3.amazonaws.com/bucket/shared/conversations/conv_abc123/media-789.jpg?X-Amz-Signature=..."
        contentType:
          type: string
          description: MIME type of the content
          example: "image/jpeg"
        expiresAt:
          type: integer
          format: int64
          description: Unix timestamp when signed URL expires (microseconds)
          example: 1696803600000000

    MessageRequest:
      type: object
      required:
        - conversationId
        - from
        - timestamp
        - content
      properties:
        conversationId:
          type: string
          description: Conversation identifier
          maxLength: 255
          example: "conv_abc123"
        contentRef:
          type: string
          description: Optional reference to uploaded media (from /api/v1/messages/upload)
          nullable: true
          example: "s3://bucket/shared/conversations/conv_abc123/media-1234567890123456.jpg"
        from:
          type: string
          description: Sender user ID
          maxLength: 255
          example: "user_john"
        timestamp:
          type: integer
          format: int64
          description: Unix timestamp in microseconds (UTC)
          example: 1696800000000000
        content:
          type: string
          description: Message body/text or caption for media messages
          minLength: 1
          maxLength: 1048576
          example: "Hello, how are you?"
        metadata:
          type: object
          description: Flexible key-value metadata (role, contentType, fileName, fileSize, dimensions, duration, etc.)
          additionalProperties: true
          example:
            role: "user"
            clientId: "web-app"
            contentType: "image/jpeg"
            fileName: "vacation-photo.jpg"
            fileSize: 2457600
            width: 1920
            height: 1080

    MessageResponse:
      type: object
      properties:
        msgId:
          type: integer
          format: int64
          description: Generated snowflake ID for this message
          example: 1234567890123456
        acknowledged:
          type: boolean
          description: True if message was accepted and stored
          example: true

    Message:
      type: object
      properties:
        msgId:
          type: integer
          format: int64
          example: 1234567890123456
        conversationId:
          type: string
          example: "conv_abc123"
        from:
          type: string
          example: "user_john"
        timestamp:
          type: integer
          format: int64
          description: Unix timestamp in microseconds (UTC)
          example: 1696800000000000
        content:
          type: string
          description: Message content, caption for media, or truncated preview for large messages (first 1KB).
          example: "Hello, how are you?"
        contentRef:
          type: string
          description: Optional reference URI for large message content or media files (images, documents, audio, video, etc.)
          nullable: true
          example: "s3://bucket/shared/conversations/conv_abc123/media-1234567890123456.jpg"
        metadata:
          type: object
          additionalProperties: true
          example:
            role: "user"
            contentType: "image/jpeg"
            fileName: "vacation-photo.jpg"
            fileSize: 2457600
            width: 1920
            height: 1080
            thumbnail: "data:image/jpeg;base64,/9j/4AAQ..."

    MessagesResponse:
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: '#/components/schemas/Message'
        hasMore:
          type: boolean
          description: True if more messages available (pagination)
          example: false
        nextCursor:
          type: integer
          format: int64
          description: msgId to use as 'sinceId' for next page
          example: 1234567890123456
          nullable: true

    Conversation:
      type: object
      properties:
        conversationId:
          type: string
          example: "conv_abc123"
        firstMsgId:
          type: integer
          format: int64
          example: 1234567890000000
        lastMsgId:
          type: integer
          format: int64
          example: 1234567899999999
        created:
          type: integer
          format: int64
          description: Unix timestamp in microseconds
          example: 1696800000000000
        updated:
          type: integer
          format: int64
          description: Unix timestamp in microseconds
          example: 1696850000000000

    ConversationsResponse:
      type: object
      properties:
        conversations:
          type: array
          items:
            $ref: '#/components/schemas/Conversation'

    ConversationUser:
      type: object
      properties:
        userId:
          type: string
          example: "user_john"
        conversationId:
          type: string
          example: "conv_abc123"
        created:
          type: integer
          format: int64
          description: Unix timestamp in microseconds when user joined
          example: 1696800000000000
        updated:
          type: integer
          format: int64
          description: Unix timestamp in microseconds when membership last changed
          example: 1696850000000000
        metadata:
          type: object
          description: User-specific conversation metadata
          additionalProperties: true
          example:
            role: "participant"
            permissions: ["read", "write"]
            lastReadMsgId: 1234567890123456
            notificationsEnabled: true

    ConversationUsersResponse:
      type: object
      properties:
        users:
          type: array
          items:
            $ref: '#/components/schemas/ConversationUser'

    ConversationUserRequest:
      type: object
      required:
        - userId
      properties:
        userId:
          type: string
          description: User ID to add to the conversation
          maxLength: 255
          example: "user_jane"
        metadata:
          type: object
          description: Initial metadata for this user
          additionalProperties: true
          example:
            role: "participant"
            permissions: ["read", "write"]
            notificationsEnabled: true

    ConversationUserUpdate:
      type: object
      properties:
        metadata:
          type: object
          description: Updated metadata for this user
          additionalProperties: true
          example:
            role: "moderator"
            permissions: ["read", "write", "delete"]
            lastReadMsgId: 1234567890999999

    QueryResponse:
      type: object
      properties:
        columns:
          type: array
          description: Column names
          items:
            type: string
          example: ["conversationId", "msg_count"]
        rows:
          type: array
          description: Query result rows
          items:
            type: array
            items: {}
          example:
            - ["conv_abc123", 150]
            - ["conv_xyz789", 75]
        executionTimeMs:
          type: integer
          description: Query execution time in milliseconds
          example: 245

    SubscriptionsResponse:
      type: object
      properties:
        subscriptions:
          type: array
          items:
            type: object
            properties:
              connectionId:
                type: string
                format: uuid
                example: "550e8400-e29b-41d4-a716-446655440000"
              userId:
                type: string
                example: "user_john"
              conversationId:
                type: string
                nullable: true
                example: "conv_abc123"
              lastMsgId:
                type: integer
                format: int64
                nullable: true
                example: 1234567890123456
              connectedAt:
                type: integer
                format: int64
                description: Unix timestamp in microseconds
                example: 1696800000000000
              lastHeartbeat:
                type: integer
                format: int64
                description: Unix timestamp in microseconds
                example: 1696850000000000

    Config:
      type: object
      properties:
        messageSizeLimitBytes:
          type: integer
          description: Maximum message content size in bytes (including large messages)
          example: 10485760
        largeMessageThresholdBytes:
          type: integer
          description: Message size threshold for shared storage (messages >= this stored in shared location)
          example: 102400
        consolidationIntervalSeconds:
          type: integer
          description: Time interval between consolidation cycles
          example: 300
        consolidationMessageThreshold:
          type: integer
          description: Message count threshold for consolidation
          example: 10000
        storageBackend:
          type: string
          enum: [local, s3]
          example: "local"
        storageConfig:
          type: object
          description: Backend-specific storage configuration
          additionalProperties: true
        duplicationEnabled:
          type: boolean
          description: Enable message duplication across conversation participants
          example: true
        maxParticipantsWarning:
          type: integer
          description: Warn when conversation exceeds this many participants (high storage cost)
          example: 20

    ConfigUpdate:
      type: object
      properties:
        messageSizeLimitBytes:
          type: integer
          example: 20971520
        largeMessageThresholdBytes:
          type: integer
          example: 204800
        consolidationIntervalSeconds:
          type: integer
          example: 600
        consolidationMessageThreshold:
          type: integer
          example: 20000
        maxParticipantsWarning:
          type: integer
          example: 50

    Metrics:
      type: object
      properties:
        storage:
          type: object
          properties:
            totalMessages:
              type: integer
              format: int64
              example: 1000000
            sizeBytes:
              type: integer
              format: int64
              example: 500000000
            userCount:
              type: integer
              example: 1000
        throughput:
          type: object
          properties:
            messagesPerSecond:
              type: number
              format: float
              example: 150.5
            queriesPerSecond:
              type: number
              format: float
              example: 10.2
        subscriptions:
          type: object
          properties:
            activeConnections:
              type: integer
              example: 500
        performance:
          type: object
          properties:
            cpuPercent:
              type: number
              format: float
              example: 45.2
            memoryMB:
              type: integer
              example: 2048
            diskIOPS:
              type: integer
              example: 100

    Error:
      type: object
      properties:
        error:
          type: string
          description: Error message
          example: "Invalid request: missing required field 'conversationId'"
        code:
          type: string
          description: Error code for programmatic handling
          example: "MISSING_FIELD"
